<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>slink - Create Short Link</title>
<style>
body {
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  max-width: 720px;
  margin: 40px auto;
  padding: 0 16px;
  line-height: 1.6;
}
h1 {
  color: #333;
  margin-bottom: 30px;
}
.form-group {
  margin-bottom: 20px;
}
label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #555;
}
input, textarea, button {
  font: inherit;
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  box-sizing: border-box;
}
textarea {
  height: 150px;
  resize: vertical;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.2s;
}
button:hover {
  background: #0056b3;
}
button:disabled {
  background: #ccc;
  cursor: not-allowed;
}
#result {
  margin-top: 20px;
  padding: 15px;
  border-radius: 6px;
  display: none;
}
.success {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}
.error {
  background: #f8d7da;
  border: 1px solid #f5c6cb;
  color: #721c24;
}
.short-link {
  font-family: monospace;
  background: #f8f9fa;
  padding: 8px 12px;
  border-radius: 4px;
  display: inline-block;
  margin-top: 10px;
}
</style>
</head>
<body>
<h1>ğŸ”— slink - åˆ›å»ºçŸ­é“¾æ¥</h1>
<p>è¾“å…¥ä½ çš„å†…å®¹å’Œå¯†é’¥æ¥åˆ›å»ºä¸€ä¸ªåŠ å¯†çš„çŸ­é“¾æ¥ã€‚</p>

<form id="createForm">
  <div class="form-group">
    <label for="content">å†…å®¹ (Content):</label>
    <textarea id="content" placeholder="è¾“å…¥ä½ æƒ³è¦åˆ†äº«çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬æˆ–URL..." required></textarea>
  </div>
  
  <div class="form-group">
    <label for="key">å¯†é’¥ (Key):</label>
    <input type="password" id="key" placeholder="è¾“å…¥ä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†ä½ çš„å†…å®¹..." required />
  </div>
  
  <button type="submit" id="submitBtn">åˆ›å»ºçŸ­é“¾æ¥</button>
</form>

<div id="result"></div>

<script>
document.getElementById('createForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const content = document.getElementById('content').value.trim();
  const key = document.getElementById('key').value.trim();
  const submitBtn = document.getElementById('submitBtn');
  const result = document.getElementById('result');
  
  if (!content || !key) {
    showResult('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
    return;
  }
  
  submitBtn.disabled = true;
  submitBtn.textContent = 'åˆ›å»ºä¸­...';
  
  try {
    const response = await fetch('/api/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ content, key })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      const shortUrl = window.location.origin + '/' + data.short;
      showResult(`çŸ­é“¾æ¥åˆ›å»ºæˆåŠŸï¼<br><div class="short-link">${shortUrl}</div><br>æäº¤å“ˆå¸Œ: ${data.commitHash}`, 'success');
      document.getElementById('createForm').reset();
    } else {
      showResult(`åˆ›å»ºå¤±è´¥: ${data.error}`, 'error');
    }
  } catch (error) {
    showResult(`ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'åˆ›å»ºçŸ­é“¾æ¥';
  }
});

function showResult(message, type) {
  const result = document.getElementById('result');
  result.innerHTML = message;
  result.className = type;
  result.style.display = 'block';
  result.scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
