<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>slink</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
  background: white;
  color: #333;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.container {
  padding: 40px;
  width: 100%;
  max-width: 680px;
}

#createForm {
  display: flex;
  gap: 8px;
  align-items: center;
}

#content {
  flex-grow: 1;
}

input, textarea {
  height: 47px;
  width: 100%;
  padding: 16px;
  transition: all 0.2s ease;
  background: #fafafa;
  border: none;
}

input:focus, textarea:focus {
  outline: none;
  background: #f0f0f0;
}

textarea {
  resize: true;
  font-family: inherit;
}

.key-container {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  position: relative;
  width: 120px;
}
button {
  border: 0;
  outline: 0;
  background-color: transparent;
}

.generate-btn {
  position: absolute;
  right: 0;
  padding: 16px;
  cursor: pointer;
  font-size: 20px;
  color: #666;
  transition: all 0.2s ease;
  line-height: 1;
  white-space: nowrap;
}
input {
  padding-right: 44px;
}

.submit-btn {
  flex-shrink: 0;
  height: 45px;
  width: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #007AFF;
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
}

.submit-btn:hover:not(:disabled) {
  background: #0056CC;
  transform: translateY(-1px);
}

.submit-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
}

.result {
  margin-top: 24px;
  padding: 20px;
  display: none;
  animation: fadeIn 0.3s ease;
}

.success {
  background: #f0f9ff;
  color: #0369a1;
}

.error {
  background: #fef2f2;
  color: #dc2626;
}

.short-link {
  display: inline-block;
  background: white;
  padding: 12px 16px;
  margin-top: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: all;
}

.short-link:hover {
  background: #f8f8f8;
}

.copied {
  background: #dcfce7 !important;
  color: #166534 !important;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 480px) {
  .container {
    padding: 24px;
    margin: 0;
  }
  
  .key-container {
    flex-direction: column;
  }
  
  .generate-btn {
    width: 100%;
  }
}
</style>
</head>
<body>
<div class="container">

  <form id="createForm">
    <textarea id="content" placeholder="Enter your content or URL..." required ></textarea>
  
    <div class="key-container">
      <input type="text" id="key" placeholder="key" required />
      <button type="button" class="generate-btn" id="generateBtn">⚄</button>
    </div>
    
    <button type="submit" class="submit-btn" id="submitBtn">→</button>
  </form>

  <div id="result" class="result"></div>
</div>

<script>
function generateRandomKey() {
  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
  let result = '';
  for (let i = 0; i < 2; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
}

document.addEventListener('DOMContentLoaded', function() {
  const keyInput = document.getElementById('key');
});

document.getElementById('generateBtn').addEventListener('click', function() {
  const keyInput = document.getElementById('key');
  keyInput.value = generateRandomKey();
  keyInput.focus();
});

async function copyToClipboard(text) {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (err) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      document.body.removeChild(textArea);
      return true;
    } catch (err) {
      document.body.removeChild(textArea);
      return false;
    }
  }
}

document.getElementById('createForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const content = document.getElementById('content').value.trim();
  const key = document.getElementById('key').value.trim();
  const submitBtn = document.getElementById('submitBtn');
  const result = document.getElementById('result');
  
  if (!content || !key) {
    showResult('Please fill in all fields', 'error');
    return;
  }
  
  submitBtn.disabled = true;
  submitBtn.textContent = 'Creating...';
  
  try {
    const response = await fetch('/api/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ content, key })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      const shortUrl = window.location.origin + '/' + data.short;
      showResult(`Link created successfully!<br><div class="short-link" onclick="copyLink('${shortUrl}', this)">${shortUrl}</div><br><small>Commit: ${data.commitHash}</small>`, 'success');
      document.getElementById('createForm').reset();
      document.getElementById('key').value = generateRandomKey();
    } else {
      showResult(`Failed to create link: ${data.error}`, 'error');
    }
  } catch (error) {
    showResult(`Network error: ${error.message}`, 'error');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = '→';
  }
});

async function copyLink(url, element) {
  const success = await copyToClipboard(url);
  if (success) {
    element.textContent = 'Copied!';
    element.classList.add('copied');
    setTimeout(() => {
      element.textContent = url;
      element.classList.remove('copied');
    }, 2000);
  }
}

function showResult(message, type) {
  const result = document.getElementById('result');
  result.innerHTML = message;
  result.className = `result ${type}`;
  result.style.display = 'block';
  result.scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
